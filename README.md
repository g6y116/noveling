<div align="center">
  <img src="https://github.com/g6y116/PersonalProject/assets/121198194/cace1d2c-9a2c-4321-a85c-df69b98358c1" width="64px">
  <H1>ëª¨ë‘ì˜ ì†Œì„¤ ê³µê°„ - Noveling</H1>
</div>

# ë°°í¬ ì •ë³´

 http://13.124.98.233

- ID : qwer
- Pw : qwerqwer

# ì†Œê°œ

- ì†Œì„¤ì„ ì˜¬ë¦¬ê³  ê³µìœ í•˜ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.
- í•™ìƒ ì‹œì ˆ PHPë¡œ ë§Œë“¤ì—ˆë˜ ê¸°íšì„ ê°€ì ¸ì™€ Springìœ¼ë¡œ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
- í˜„ì¬ ì´ í”„ë¡œì íŠ¸ëŠ” AWS LightSailë¡œ í˜¸ìŠ¤íŒ… ë˜ê³  ìˆìŠµë‹ˆë‹¤.

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/g6y116/Noveling/assets/121198194/e820abbf-1318-4af6-b03b-6ec86a515618" width="400px">
      <figcaption><p>í•™ìƒ ì‹œì ˆ PHPë¡œ ë§Œë“  ì‚¬ì´íŠ¸</p></figcaption>
    </td>
    <td align="center">
      <img src="https://github.com/g6y116/PersonalProject/assets/121198194/18f458c1-3479-49a2-a2ba-928577ab4a96" width="400px">
      <figcaption><p>í˜„ì¬ í˜¸ìŠ¤íŒ… ì‚¬ì´íŠ¸</p></figcaption>
    </td>
  </tr>
</table>

# í”„ë¡œì íŠ¸ ì •ë³´

- Java 11 / SpringBoot 2.7.17
- Thymeleaf / Spring Data JPA / QueryDsl / Lombok / SpringSecurity / Bootstrap 5.0
- Mysql 8.0.35 / H2
- AWS LightSail

# íŒ¨í‚¤ì§€ êµ¬ì¡°

```
ğŸ“¦sj
 â”— ğŸ“‚noveling
 â”ƒ â”£ ğŸ“‚controller
 â”ƒ â”ƒ â”£ ğŸ“œChapterController.java
 â”ƒ â”ƒ â”£ ğŸ“œCommentController.java
 â”ƒ â”ƒ â”£ ğŸ“œHomeController.java
 â”ƒ â”ƒ â”— ğŸ“œNovelController.java
 â”ƒ â”£ ğŸ“‚dto
 â”ƒ â”ƒ â”£ ğŸ“œChapterDetailDto.java
 â”ƒ â”ƒ â”£ ğŸ“œChapterSimpleDto.java
 â”ƒ â”ƒ â”£ ğŸ“œCommentDto.java
 â”ƒ â”ƒ â”£ ğŸ“œNovelDetailDto.java
 â”ƒ â”ƒ â”— ğŸ“œNovelSimpleDto.java
 â”ƒ â”£ ğŸ“‚entity
 â”ƒ â”ƒ â”£ ğŸ“œChapter.java
 â”ƒ â”ƒ â”£ ğŸ“œComment.java
 â”ƒ â”ƒ â”£ ğŸ“œMember.java
 â”ƒ â”ƒ â”— ğŸ“œNovel.java
 â”ƒ â”£ ğŸ“‚exception
 â”ƒ â”ƒ â”£ ğŸ“œDataExistsException.java
 â”ƒ â”ƒ â”£ ğŸ“œDataNotFoundException.java
 â”ƒ â”ƒ â”— ğŸ“œNoPermissionException.java
 â”ƒ â”£ ğŸ“‚form
 â”ƒ â”ƒ â”£ ğŸ“œAddChapterForm.java
 â”ƒ â”ƒ â”£ ğŸ“œAddCommentForm.java
 â”ƒ â”ƒ â”£ ğŸ“œAddNovelForm.java
 â”ƒ â”ƒ â”£ ğŸ“œJoinForm.java
 â”ƒ â”ƒ â”£ ğŸ“œLoginForm.java
 â”ƒ â”ƒ â”£ ğŸ“œSetChapterForm.java
 â”ƒ â”ƒ â”£ ğŸ“œSetCommentForm.java
 â”ƒ â”ƒ â”— ğŸ“œSetNovelForm.java
 â”ƒ â”£ ğŸ“‚repository
 â”ƒ â”ƒ â”£ ğŸ“œChapterRepository.java
 â”ƒ â”ƒ â”£ ğŸ“œCommentRepository.java
 â”ƒ â”ƒ â”£ ğŸ“œMemberRepository.java
 â”ƒ â”ƒ â”£ ğŸ“œNovelRepository.java
 â”ƒ â”ƒ â”— ğŸ“œQueryDslRepository.java
 â”ƒ â”£ ğŸ“‚service
 â”ƒ â”ƒ â”£ ğŸ“œChapterService.java
 â”ƒ â”ƒ â”£ ğŸ“œCommentService.java
 â”ƒ â”ƒ â”£ ğŸ“œMemberService.java
 â”ƒ â”ƒ â”£ ğŸ“œNovelService.java
 â”ƒ â”ƒ â”— ğŸ“œSecurityService.java
 â”ƒ â”£ ğŸ“‚type
 â”ƒ â”ƒ â”£ ğŸ“œGenre.java
 â”ƒ â”ƒ â”— ğŸ“œGrade.java
 â”ƒ â”£ ğŸ“œConst.java
 â”ƒ â”£ ğŸ“œNovelingApplication.java
 â”ƒ â”— ğŸ“œSecurityConfig.java
```
# í•µì‹¬ ê¸°ëŠ¥

### ë¡œê·¸ì¸/íšŒì›ê°€ì…

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ëŠ¥ êµ¬í˜„

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/3cc0d0ed-8497-4acd-af3b-0aa7ce915bed" width="40%">

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/9e4ce35f-400f-4f7f-8d81-4d1faf300d41" width="40%">

SecurityConfig.java
```
@Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests((authorizeHttpRequests) -> authorizeHttpRequests.requestMatchers(new AntPathRequestMatcher("/**")).permitAll())
            .csrf((csrf) -> csrf.ignoringRequestMatchers(new AntPathRequestMatcher("/h2-console/**")))
            .headers((headers) -> headers.addHeaderWriter(new XFrameOptionsHeaderWriter(XFrameOptionsHeaderWriter.XFrameOptionsMode.SAMEORIGIN)))
            .formLogin((formLogin) -> formLogin.loginPage("/login").defaultSuccessUrl("/"))
            .logout((logout) -> logout.logoutRequestMatcher(new AntPathRequestMatcher("/logout")).logoutSuccessUrl("/").invalidateHttpSession(true))
        ;
        return http.build();
    }
```

### ì†Œì„¤ ì¡°íšŒ ë° í˜ì´ì§•(ì¥ë¥´ / ê²€ìƒ‰)

QueryDslë¡œ ë™ì  ì¿¼ë¦¬

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/484017b6-f0d6-4871-b618-df2186a2032f" width="80%">

QueryDslRepository.java
```
public Page<Novel> pageNovels(String query, Genre genre, Pageable pageable) {
    QueryResults<Novel> results = queryFactory
            .selectFrom(novel).join(novel.member, member)
            .where(queryEq(query), genreEq(genre))
            .orderBy(novel.id.desc())
            .offset(pageable.getOffset())
            .limit(pageable.getPageSize()).fetchResults();

    List<Novel> content = results.getResults();
    long total = results.getTotal();

    return new PageImpl<>(content, pageable, total);
}

private BooleanExpression queryEq(String query) {
    return query != null ? (novel.title.contains(query)).or(novel.member.name.contains(query)) : null;
}

private BooleanExpression genreEq(Genre genre) {
    return genre != null ? novel.genre.eq(genre) : null;
}
```

### ì†Œì„¤ / íšŒì°¨ / ëŒ“ê¸€ CRUD

- ë¹ˆ ìœ íš¨ì„± ê²€ì‚¬
- ê¶Œí•œì´ ì—†ëŠ” ê²½ìš° ë¦¬ë‹¤ì´ë ‰íŠ¸
- ì˜ˆì™¸ ë°œìƒ ì‹œ ì˜¤ë¥˜í˜ì´ì§€ í‘œì‹œ
- ì»¨íŠ¸ë¡¤ëŸ¬ì— DTO ë°˜í™˜ í›„ ì‚¬ìš©

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/fd1f9eed-617d-4601-a649-e13ec6739100" width="80%">

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/e7186e62-425b-4566-994d-316403e67f4f" width="80%">

Novel.java (Entity)
```
public NovelDetailDto toNovelDetailDto() {
    ...
    return new NovelDetailDto(
            ...
            reverseChapters.stream().map(Chapter::toChapterSimpleDto).collect(Collectors.toList())
    );
}
```

NovelService.java (Service)
```
public NovelDetailDto getNovel(Long novelId) {
    Optional<Novel> originResult = novelRepository.findById(novelId);

    if (originResult.isPresent()) {
        originResult.get().setViewCount(originResult.get().getViewCount() + 1); // ì¡°íšŒ ìˆ˜ ì²˜ë¦¬
        novelRepository.save(originResult.get());
        return originResult.get().toNovelDetailDto();
    } else {
        throw new DataNotFoundException("ì‘í’ˆì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
}
```

AddNovelForm.java (Form)
```
public class AddNovelForm {

  @NotEmpty(message = "í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.")
  @Size(max=64, message = "64 ê¸€ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.")
  private String title;

  ...
}
```

### ì¸ê¸° ì‘í’ˆ / ìµœì‹  ì‘í’ˆ ì¶”ì²œ

ì¸ê¸° ì‘í’ˆì€ ì¡°íšŒ ìˆ˜ ê¸°ë°˜, ìµœì‹  ì‘í’ˆì€ íšŒì°¨ ì—…ë°ì´íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œ

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/5e1285ec-8e99-4968-83c9-750dff963ca6" width="30%">

<img src="https://github.com/g6y116/PersonalProject/assets/121198194/4ecfa084-6c82-4a4c-a8ad-a54fd55e6095" width="30%">

NovelService.java (Service)
```
public List<NovelSimpleDto> getNewestNovels() {
    List<Novel> originResults = queryDslRepository.newestNovels();

    return originResults.stream().map(Novel::toNovelSimpleDto).collect(Collectors.toList());
}

public List<NovelSimpleDto> getBestNovels() {
    List<Novel> originResults = queryDslRepository.bestNovels();

    return originResults.stream().map(Novel::toNovelSimpleDto).collect(Collectors.toList());
}
```

QueryDslRepository.java (Repository)
```
// ìµœê·¼ ì‘í’ˆ ë¦¬ìŠ¤íŠ¸
public List<Novel> newestNovels() {
    QueryResults<Novel> results = queryFactory
            .selectFrom(novel)
            .where(novel.modifyDate.isNotNull())
            .orderBy(novel.modifyDate.desc())
            .limit(3)
            .fetchResults();

    List<Novel> contents = results.getResults();
    return contents;
}

// ì¸ê¸° ì‘í’ˆ ë¦¬ìŠ¤íŠ¸
public List<Novel> bestNovels() {
    QueryResults<Novel> results = queryFactory
            .selectFrom(novel)
            .where(novel.viewCount.ne(0))
            .orderBy(novel.viewCount.desc())
            .limit(3)
            .fetchResults();

    List<Novel> contents = results.getResults();
    return contents;
}
```

# êµ¬í˜„ ë¡œê·¸

ì—”í‹°í‹°ëª… ë³€ê²½

User -> Member
- Userê°€ DBì—ì„œ ì˜ˆì•½ì–´ë¡œ ì§€ì •ë˜ì–´ ìˆì–´ ë³€ê²½

Page -> Chapter
- org.springframework.data.domain.Pageì™€ í´ë˜ìŠ¤ëª…ì´ ê²¹ì³ì„œ ë³€ê²½
- ì½”í‹€ë¦°ì—ì„œëŠ” ì„í¬íŠ¸ ë¶€ë¶„ì— asë¡œ ë³„ì¹­ì„ ì¤„ ìˆ˜ ìˆìœ¼ë‚˜ ìë°”ëŠ” ì—†ì–´ì„œ ì•„ì‰¬ì› ìŒ.

ì½”í‹€ë¦°ì˜ data classë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆìœ¼ë‚˜ ë¡¬ë¶ì„ ì‚¬ìš©í•˜ì—¬ ì½”ë“œì˜ ë¶€í”¼ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì—ˆìŒ.

ì¿¼ë¦¬ dsl ì½”ë“œì˜ ë¶€í”¼ê°€ í¬ì§€ ì•Šì•„ ë¶„ë¦¬ëœ ë ˆí¬ì§€í† ë¦¬ í´ë˜ìŠ¤ë¡œ ì‘ì„±

ì„œë¹„ìŠ¤ë³„ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

AWS ë¹„ìš© ì´ìŠˆë¡œ ì¸í•´ AWS LightSail ì‚¬ìš©
